<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/auvsi-client.js | auvsisuas-client-node API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/uavaustin/auvsisuas-client-node" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/auvsi-client.js~AUVSIClient.html">AUVSIClient</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-verifyTelem">verifyTelem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Telemetry">Telemetry</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/auvsi-client.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

import request from &apos;request-promise-native&apos;;

import { verifyTelem } from &apos;./helpers&apos;;

/**
 * Client to interact with the AUVSI SUAS Interoperability Server.
 */
export default class AUVSIClient {
    /**
     * Create a new AUVSIClient.
     *
     * This does not handle logging in the server. To log in, see
     * {@link login}.
     */
    constructor() {
        this._setup();
    }

    /**
     * Whether or not the client is currently logged in.
     *
     * @type {boolean}
     */
    get loggedIn() {
        return this._loggedIn;
    }

    /**
     * The base URL of the interop server.
     *
     * This will be an empty string if not logged in.
     *
     * @type {string}
     */
    get url() {
        return this._url;
    }

    /**
     * Set up the base request function and logged out status.
     */
    _setup() {
        this._loggedIn = false;
        this._url = &apos;&apos;;

        this._req = request.defaults({ jar: true });
    }

    /**
     * Send a base request.
     *
     * @private
     * @see https://github.com/request/request-promise-native#readme
     * @param  {Object} options           - Request options
     * @param  {string} options.url       - Interop server URL
     * @param  {string} options.uri       - Interop server endpoint
     * @param  {string} options.method    - Must be one of &apos;GET&apos;,
     *                                      POST&apos;, &apos;PUT&apos;, or &apos;DELETE&apos;
     * @param  {Object} [options.headers] - Custom HTTP headers
     * @param  {string} [options.headers[&apos;content-type&apos;]]
     *                                    - Content type header
     * @param  {Object} [options.form]    - Encodes and sends a form
     * @param  {Object} [options.json]    - Send an object as json
     * @param  {number} [options.timeout=10000]
     *                                    - Request timeout in ms
     * @return {Promise&lt;Response, Error&gt;}
     */
    _request(options) {
        // If we&apos;re not logged in and we&apos;re not trying to, return an
        // error
        if (!this.loggedIn &amp;&amp; options.url === undefined) {
            return Promise.reject(new Error(&apos;not logged in&apos;));
        }

        options.url = (options.url || this.url) + options.uri;
        delete options.uri;

        options.resolveWithFullResponse = true;
        options.timeout = options.timeout || 10000;

        return this._req(options).then((response) =&gt; {
            if (!/^2/.exec(response.statusCode.toString())) {
                throw new Error(response.body || &apos;unknown error&apos;);
            }

            return response;
        });
    }

    /**
     * Log in to the interop server.
     *
     * @param  {string} url            - Interop url
     * @param  {string} username       - Interop username
     * @param  {string} password       - Interop password
     * @param  {number} [timeout=1000] - Request timeout in ms
     * @return {Promise&lt;void, Error&gt;}
     */
    login(url, username, password, timeout) {
        return this._request({
            method: &apos;POST&apos;,
            url,
            uri: &apos;/api/login&apos;,
            form: { username, password },
            timeout
        }).then(() =&gt; {
            this._url = url;
            this._loggedIn = true;
        }).catch((err) =&gt; {
            this._url = &apos;&apos;;
            throw err;
        });
    }

    /**
     * Log out of the interop server.
     *
     * @return {Promise&lt;void, Error&gt;}
     */
    logout() {
        this._setup();
    }

    /**
     * Post telemetry to the interop server.
     *
     * @param  {Telemetry} telem           - Telemetry to post
     * @param  {number}    [timeout=10000] - Request timeout in ms
     * @return {Promise&lt;void, Error&gt;}
     */
    postTelemetry(telem, timeout = 10000) {
        return verifyTelem(telem).then(() =&gt; this._request({
            method: &apos;POST&apos;,
            uri: &apos;/api/telemetry&apos;,
            form: {
                latitude: telem.lat,
                longitude: telem.lon,
                altitude_msl: telem.alt_msl,
                uas_heading: telem.yaw
            },
            timeout
        }));
    }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
